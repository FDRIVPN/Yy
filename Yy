from flask import Flask, request
import requests
import json
import random

app = Flask(__name__)

TOKEN = '7359765323:AAFs47ndFxtjyhC7KBOT7Z9rAyGm7RRNFGU'
URL = f'http://t.me/rocksquirrel_bot/App{TOKEN}/'

# دیکشنری برای ذخیره امتیاز کاربران
scores = {}

@app.route('/webhook', methods=['POST'])
def webhook():
    update = request.get_json()
    chat_id = update['message']['chat']['id']
    text = update['message'].get('text')

    if text == '/start':
        send_message(chat_id, "Welcome to Coin Toss Game! Type /play to start.")
    elif text == '/play':
        play_game(chat_id)
    else:
        send_message(chat_id, "Unknown command. Type /play to start.")

    return '', 200

def play_game(chat_id):
    result = random.choice(['Heads', 'Tails'])
    send_message(chat_id, f"The coin landed on: {result}")
    
    # افزایش امتیاز
    if chat_id in scores:
        scores[chat_id] += 1
    else:
        scores[chat_id] = 1

    send_message(chat_id, f"Your score is: {scores[chat_id]}")

def send_message(chat_id, text):
    requests.post(URL + 'sendMessage', json={'chat_id': chat_id, 'text': text})

if __name__ == '__main__':
    app.run(port=5000)
